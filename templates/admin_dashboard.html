<!DOCTYPE html>
<html>
<head>
  <title>å¾Œå°å°ˆæ¡ˆç®¡ç†</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <!-- å°è¦½åˆ—é–‹å§‹ -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">å·¥ç¨‹é€²åº¦ç³»çµ±</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          {% if session.role == 'staff' %}
            <li class="nav-item"><a class="nav-link" href="/admin">å¾Œå°é¦–é </a></li>
            <li class="nav-item"><a class="nav-link" href="/admin/new_project">æ–°å¢å°ˆæ¡ˆ</a></li>
            <li class="nav-item"><a class="nav-link" href="/admin/manage_users">ç®¡ç†ä½¿ç”¨è€…å¸³è™Ÿ</a></li>
          {% endif %}
          <li class="nav-item"><a class="nav-link" href="/logout">ç™»å‡º</a></li>
        </ul>
      </div>
    </div>
  </nav>
  <!-- å°è¦½åˆ—çµæŸ -->

  <div class="container mt-5">
    <h2 class="mb-4">å¾Œå°ç®¡ç† - {{ user }}</h2>
    <a href="/admin/new_project" class="btn btn-primary mb-3">ï¼‹ æ–°å¢å°ˆæ¡ˆ</a>
    <a href="/admin/manage_users" class="btn btn-outline-primary mb-3">ğŸ‘¥ ç®¡ç†ä½¿ç”¨è€…å¸³è™Ÿ</a>
    <a href="/admin/assign_projects_to_user" class="btn btn-outline-primary mb-3">â†’ æŒ‡æ´¾ä½¿ç”¨è€…å¯æŸ¥çœ‹å°ˆæ¡ˆ</a>
    <a href="/admin/upload_step_icons" class="btn btn-outline-secondary mb-3">ğŸ–¼ ä¸Šå‚³é€²åº¦åœ–ç¤º</a>

    <div class="list-group">
      {% for project in projects %}
        <div class="list-group-item">
          <strong><a href="/project/{{ project.id }}" target="_blank">{{ project.title }}</a></strong><br>
          å®¢æˆ¶ï¼š{{ project.client_name or 'ï¼ˆæœªå¡«ï¼‰' }} / {{ project.client_phone }}<br>
          åœ°å€ï¼š{{ project.install_address or 'ï¼ˆæœªå¡«ï¼‰' }}<br>

          <a href="/admin/project/{{ project.id }}/steps" class="btn btn-sm btn-outline-secondary mt-2">ğŸ“‹ ç®¡ç†é€²åº¦</a>

          <form action="/admin/delete_project" method="POST" class="d-inline ms-2" onsubmit="return confirm('âš ï¸ ç¢ºå®šè¦åˆªé™¤æ•´å€‹å°ˆæ¡ˆå—ï¼Ÿé€™å°‡åˆªé™¤é€²åº¦èˆ‡æˆæ¬Šï¼')">
            <input type="hidden" name="project_id" value="{{ project.id }}">
            <button type="submit" class="btn btn-sm btn-outline-danger">ğŸ—‘ åˆªé™¤å°ˆæ¡ˆ</button>
          </form>

          <p class="mt-3 mb-1 fw-bold">æˆæ¬Šå¸³è™Ÿï¼š</p>
          <ul class="mb-2">
            {% for user in project.authorized_users %}
              <li>
                {{ user.phone }}ï¼ˆ{{ 'é¡§å®¢' if user.role == 'customer' else 'æ¥­å‹™' if user.role == 'sales' else user.role }}ï¼‰
                <form action="/admin/remove_permission" method="POST" class="d-inline ms-2" onsubmit="return confirm('ç¢ºå®šè¦ç§»é™¤é€™å€‹æˆæ¬Šå¸³è™Ÿå—ï¼Ÿ')">
                  <input type="hidden" name="phone" value="{{ user.phone }}">
                  <input type="hidden" name="project_id" value="{{ project.id }}">
                  <button type="submit" class="btn btn-sm btn-danger">ç§»é™¤</button>
                </form>
              </li>
            {% endfor %}
          </ul>
        </div>
      {% endfor %}
    </div>
    <a href="/logout" class="btn btn-link mt-4">ç™»å‡º</a>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
